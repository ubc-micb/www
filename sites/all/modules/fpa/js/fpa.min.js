(function t(e,i,o,r){"use strict";var s=function(t,e){this.init(t,e);return this};s.prototype.selector={form:"#user-admin-permissions",table:"#permissions"};s.prototype.init=function(t,e){this.drupal_html_class_cache={};this.dom={};this.attr=e.attr||{permission:"fpa-permission",module:"fpa-module",role:"fpa-role"};this.filter_timeout=null;this.filter_timeout_time=0;this.filter_selector_cache={"*=":{},"~=":{}};this.selector.table_base_selector=".fpa-table-wrapper tr["+this.attr.module+"]";this.selector.list_counter_selector=".fpa-perm-counter";this.selector.list_base_selector=".fpa-left-section li["+this.attr.module+"]";if(this.select(t)){this.prepare();this.authenticated_role_behavior()}};s.prototype.styles={module_active_style:"{margin-right:-1px; background-color: white; border-right: solid 1px transparent;}"};s.prototype.drupal_clean_css_identifier=function(t){return t.replace(/[ _\/\[]/g,"-").replace(/\]/g,"").replace(/[^\u002D\u0030-\u0039\u0041-\u005A\u005F\u0061-\u007A\u00A1-\uFFFF]/,"")};s.prototype.drupal_html_class=function(t){if(this.drupal_html_class_cache[t]===undefined){this.drupal_html_class_cache[t]=this.drupal_clean_css_identifier(t.toLowerCase())}return this.drupal_html_class_cache[t]};s.prototype.set_style=function(){if(e('<style type="text/css" />').get(0).styleSheet){return function(t,e){t.styleSheet.cssText=e}}return function(t,e){t.innerHTML=e}}();s.prototype.filter_module=function(t){t.preventDefault();t.stopPropagation();var i=e(t.currentTarget);this.dom.filter.val([this.dom.filter.val().replace(/(@.*)/,""),i.attr(this.attr.module)!==""?"@"+i.find("a[href]").text():""].join(""));this.filter("~=")};s.prototype.build_filter_selectors=function(t,i){var o=t.match(/^\s*([^@]*)@?(.*?)\s*$/i);o.shift();var r=e.map(o,e.proxy(this.drupal_html_class,this));this.filter_selector_cache[i][t]=[r[0].length>0?"["+this.attr.permission+'*="'+r[0]+'"]':"",r[1].length>0?"["+this.attr.module+i+'"'+r[1]+'"]':""];return this.filter_selector_cache[i][t]};s.prototype.get_filter_selectors=function(t,e){e=e||"*=";t=t||this.dom.filter.val();return this.filter_selector_cache[e][t]||this.build_filter_selectors(t,e)};s.prototype.permission_grid_styles=function(t){t=t||this.get_filter_selectors();return[this.selector.table_base_selector,"{display: none;}",this.selector.table_base_selector,t[0],t[1],"{display: table-row;}"].join("")};s.prototype.counter_styles=function(t){t=t||this.get_filter_selectors();return[this.selector.list_counter_selector,"{display: none;}",this.selector.list_counter_selector,t[0],"{display: inline;}"].join("")};s.prototype.module_list_styles=function(t){t=t||this.get_filter_selectors();return[this.selector.list_base_selector,t[1].length>0?t[1]:"["+this.attr.module+'=""]',this.styles.module_active_style].join("")};s.prototype.save_filters=function(){this.dom.filter.get(0).defaultValue=this.dom.filter.val();this.dom.role_select.find("option").each(function(t,e){e.defaultSelected=e.selected})};s.prototype.filter=function(t){t=t||"*=";var i=this.dom.filter.val();e.cookie("fpa_filter",i,{path:"/"});e.cookie("fpa_module_match",t,{path:"/"});this.save_filters();var o=this.get_filter_selectors(i,t);this.set_style(this.dom.perm_style,[this.permission_grid_styles(o),this.counter_styles(o),this.module_list_styles(o)].join(""))};s.prototype.build_role_selectors=function(t){t=t||this.dom.role_select.val();var i=["*"];if(e.inArray("*",t)===-1){i=e.map(t,e.proxy(function(t,e){return"["+this.attr.role+'="'+t+'"]'},this))}return i};s.prototype.filter_roles=function(){this.save_filters();var t=this.dom.role_select.val()||[];var i=[];e.cookie("fpa_roles",JSON.stringify(t),{path:"/"});if(e.inArray("*",t)===-1){i.push(".fpa-table-wrapper ["+this.attr.role+"] {display: none;}");if(t.length>0){var o=this.build_role_selectors(t);i=i.concat(e.map(o,e.proxy(function(t,e){return".fpa-table-wrapper "+t+" {display: table-cell;}"},this)));i.push(".fpa-table-wrapper "+o.pop()+" {border-right: 1px solid #bebfb9;}")}else{i.push('td[class="permission"] {border-right: 1px solid #bebfb9;}')}}this.set_style(this.dom.role_style,i.join(""))};s.prototype.select=function(t){this.dom.context=e(t);this.dom.form=this.dom.context.find(this.selector.form);if(this.dom.form.length===0){return false}this.dom.container=this.dom.form.find(".fpa-container");this.dom.perm_style=this.dom.container.find(".fpa-perm-styles style").get(0);this.dom.role_style=this.dom.container.find(".fpa-role-styles style").get(0);this.dom.section_left=this.dom.container.find(".fpa-left-section");this.dom.section_right=this.dom.container.find(".fpa-right-section");this.dom.table_wrapper=this.dom.section_right.find(".fpa-table-wrapper");this.dom.table=this.dom.table_wrapper.find(this.selector.table);this.dom.module_list=this.dom.section_left.find("ul");this.dom.filter_form=this.dom.container.find(".fpa-filter-form");this.dom.filter=this.dom.filter_form.find('input[type="text"]');this.dom.role_select=this.dom.filter_form.find("select");return true};s.prototype.prepare=function(){this.filter_timeout_time=Math.min(this.dom.table.find("tr").length,200);this.dom.form.delegate(".fpa-toggle-container a","click",e.proxy(function t(i){i.preventDefault();var o=e(i.currentTarget).attr("fpa-toggle-class");this.dom.container.toggleClass(o).hasClass(o)},this));this.dom.section_left.delegate("li","click",e.proxy(this.filter_module,this));this.dom.filter.keypress(function i(t){if(t.which===13){t.preventDefault();t.stopPropagation()}}).keyup(e.proxy(function r(t){if(e.inArray(t.which,[13,16,17,18])===-1){o.clearTimeout(this.filter_timeout);this.filter_timeout=o.setTimeout(e.proxy(function(){this.dom.table_wrapper.detach().each(e.proxy(function(t,e){this.filter()},this)).appendTo(this.dom.section_right)},this),this.filter_timeout_time)}},this));this.dom.form.delegate('a[href*="admin/people/permissions#"]',"click",e.proxy(function s(t){t.preventDefault();t.stopPropagation();this.dom.module_list.find("li["+this.attr.module+'~="'+this.drupal_html_class(t.currentTarget.hash.substring(8))+'"]').click();e("body").scrollTop(this.dom.container.position().top)},this));if(o.location.hash.indexOf("module-")===1){this.dom.module_list.find("li["+this.attr.module+'~="'+this.drupal_html_class(o.location.hash.substring(8))+'"]').click()}this.dom.form.bind("reset",e.proxy(function l(t){o.setTimeout(e.proxy(function i(){this.dom.table_wrapper.detach().each(e.proxy(function(t,i){e(i).find('input[type="checkbox"].rid-2').each(this.dummy_checkbox_behavior)},this)).appendTo(this.dom.section_right)},this),0)},this));this.dom.section_right.delegate("th["+this.attr.role+'] input[type="checkbox"].fpa-checkboxes-toggle',"change",e.proxy(function a(t){var i=e(t.currentTarget);var o=this.get_filter_selectors(this.dom.filter.val());this.dom.table_wrapper.detach().each(e.proxy(function(t,r){e(r).find("tr"+o.join("")+" td.checkbox["+this.attr.role+'="'+i.closest("["+this.attr.role+"]").attr(this.attr.role)+'"] input[type="checkbox"][name]').attr("checked",i.attr("checked")?"checked":"").filter(".rid-2").each(this.dummy_checkbox_behavior)},this)).appendTo(this.dom.section_right)},this));this.dom.section_right.delegate('td.permission input[type="checkbox"].fpa-checkboxes-toggle',"change",e.proxy(function n(t){var i=e(t.currentTarget).closest("tr");i.prev("tr").after(i.detach().each(e.proxy(function(i,o){e(o).find("td.checkbox").filter(this.build_role_selectors().join(",")).find('input[type="checkbox"][name]').attr("checked",t.currentTarget.checked).filter(".rid-2").each(this.dummy_checkbox_behavior)},this)))},this));this.dom.section_right.delegate(".fpa-clear-search","click",e.proxy(function(){this.dom.filter.val("");this.filter()},this));this.dom.role_select.bind("change blur",e.proxy(this.filter_roles,this));o.setTimeout(e.proxy(function h(){this.dom.filter.focus()},this),0)};s.prototype.dummy_checkbox_behavior=function(){e(this).closest("tr").toggleClass("fpa-authenticated-role-behavior",this.checked)};s.prototype.authenticated_role_behavior=function(){this.dom.table_wrapper.delegate("input[type=checkbox].rid-2","mousedown",function(t){e(t.currentTarget).unbind("click.permissions")}).delegate("input[type=checkbox].rid-2","change.fpa_authenticated_role",this.dummy_checkbox_behavior).find("input[type=checkbox].rid-2:checked").each(this.dummy_checkbox_behavior)};i.behaviors.fpa={attach:function(t,i){if(r.documentElement.ontouchstart!==undefined){e(r.body).addClass("fpa-mobile")}e(o).bind("scroll",function l(t){e(t.currentTarget).triggerHandler("resize.drupal-tableheader")});new s(t,i.fpa)}};i.behaviors.permissions.attach=e.noop})(jQuery,Drupal,window,document);